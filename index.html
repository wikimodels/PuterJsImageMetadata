<!DOCTYPE html>
<html>

<body>
    <h1>Batch Image Analysis 4</h1>
    <script src="https://js.puter.com/v2/"></script>
    <script>
        const baseUrl = "https://wikimodels.github.io/PuterJsImageMetadata/images/";

        // Function to fetch image list
        async function fetchImageList() {
            try {
                const response = await fetch(`${baseUrl}images.json`); // Ensure you have a valid JSON list
                const imageNames = await response.json();
                const imageUrls = imageNames.map(name => baseUrl + name);
                return imageUrls;
            } catch (error) {
                console.error("Error fetching image list:", error);
                return [];
            }
        }

        // Function to extract the file name from the URL
        function getFileName(url) {
            const urlObject = new URL(url);
            return urlObject.pathname.split('/').pop();
        }

        // Function to analyze a single image
        async function analyzeImage(url) {
            const fileName = getFileName(url); // Extract the file name from the URL

            try {
                const response = await puter.ai.chat(
                    `Please, do this for me: Follow the SEO-Optimized Title Guidelines...`, // Shortened for brevity
                    url
                );

                if (response && response.message && response.message.content) {
                    return {
                        title: response.message.content,
                        imageFile: fileName
                    };
                } else {
                    throw new Error("Invalid response format from puter.ai.chat");
                }
            } catch (error) {
                console.error(`Error analyzing image ${url}:`, error);
                return { title: "Error analyzing image", imageFile: fileName };
            }
        }

        // Function to analyze all images
        async function analyzeAllImages(urls) {
            try {
                const promises = urls.map(url => analyzeImage(url)); // Analyze all images
                const results = await Promise.all(promises); // Wait for all analyses to complete
                return results;
            } catch (error) {
                console.error("Error analyzing images:", error);
                return [];
            }
        }

        // Main execution flow
        (async function main() {
            const imageUrls = await fetchImageList(); // Fetch the image list
            if (imageUrls.length === 0) {
                console.error("No images to analyze.");
                return;
            }

            const analysisResults = await analyzeAllImages(imageUrls); // Analyze images

            console.log("Analysis Results:", analysisResults);
            // Display the JSON as a formatted string
            document.body.innerHTML += `<pre>${JSON.stringify(analysisResults, null, 2)}</pre>`;
        })();
    </script>
</body>

</html>